

## Replace UUID Booking IDs with Serial Numbers and Add Due Info to Booking Cards

### Problem
1. Booking cards on student side show raw UUID (e.g., `377d476e-9bc5-...`) instead of the human-readable serial number (`IS-BOOK-2026-00001`)
2. Student booking view details page does not display serial number
3. Admin booking detail already uses serial number but could be more consistent
4. Due information is not shown on My Bookings cards (StudentBookings page)
5. `fetchStudentDues` function is called but never defined in `StudentDashboard.tsx` -- this is a bug
6. Student-side booking flow (locker option, advance) needs verification for consistency

### Changes

**1. StudentBookings.tsx -- Show serial_number instead of UUID on cards + Add due info**
- Update `mapBooking` to include `serial_number` from the booking data (the Supabase bookings table already has this field, auto-generated by trigger)
- Update the queries in `bookingsService.ts` (`getCurrentBookings`, `getBookingHistory`) to ensure `serial_number` is included (it already returns `*` so it's there)
- Map `serial_number` as `bookingId` in the mapped data so BookingsList displays it
- Fetch dues for the current user and attach due info (due remaining amount) to booking cards

**2. BookingsList.tsx -- Display serial_number and due badge**
- Replace the line showing `booking.cabinCode || booking.itemName` with the serial number (`booking.bookingId`)
- Show the reading room name below
- Add a "Due: amount" badge on cards where there's a pending due

**3. StudentBookingView.tsx (View Details) -- Show serial_number**
- Update `mapBookingData` to include `serial_number` from the raw data
- Display the booking serial number prominently in the header

**4. StudentDashboard.tsx -- Fix missing `fetchStudentDues`**
- Add the missing `fetchStudentDues` function that queries the `dues` table for the current user's pending dues (with cabin and seat info joined)

**5. SeatBookingForm.tsx -- Verify locker and advance options**
- The locker mandatory/optional logic is already implemented correctly
- The booking creation includes `locker_included` and `locker_price` fields -- but currently the `createBooking` call does NOT pass these values. Fix this.
- The `total_price` already includes locker deposit when applicable

**6. AdminBookingDetail.tsx -- Ensure serial_number in header**
- Already uses `booking.bookingId` which maps to `serial_number` -- no change needed

### Technical Details

**StudentBookings.tsx `mapBooking` update:**
```
// Add serial_number mapping
bookingId: booking.serial_number || booking.id?.substring(0, 8),
```

**BookingsList.tsx card title update:**
- Line 165-166: Change from showing `cabinCode` to showing `bookingId` (serial number)
- Add due badge: a red/amber badge showing "Due: amount" if the booking has a pending due

**StudentBookingView.tsx header update:**
- Show serial_number below "Booking Details" heading

**StudentDashboard.tsx -- Add fetchStudentDues:**
```typescript
const fetchStudentDues = async () => {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) return;
  const { data } = await supabase
    .from('dues')
    .select('*, cabins:cabin_id(name), seats:seat_id(number)')
    .eq('user_id', user.id)
    .order('created_at', { ascending: false });
  setStudentDues(data || []);
};
```

**SeatBookingForm.tsx -- Pass locker fields to createBooking:**
Add `locker_included` and `locker_price` to the booking creation payload based on whether locker is mandatory or opted-in.

### Files to Modify
- `src/pages/StudentBookings.tsx` -- add serial_number mapping, fetch dues
- `src/components/booking/BookingsList.tsx` -- show serial_number, add due badge
- `src/pages/students/StudentBookingView.tsx` -- show serial_number in header
- `src/pages/StudentDashboard.tsx` -- add missing fetchStudentDues function
- `src/components/seats/SeatBookingForm.tsx` -- pass locker_included and locker_price to createBooking

